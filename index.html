<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>19-Tage "Fitness"-Challenge (Lokal)</title>
    <!-- Tailwind CSS laden -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font setzen -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght=100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fc; /* Sehr hellblau/grau */
        }
        .day-card {
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .day-card.checked {
            background-color: #10b981; /* Emerald 500 */
            color: white;
            transform: scale(1.05);
            box-shadow: 0 10px 15px -3px rgb(16 185 129 / 0.5), 0 4px 6px -4px rgb(16 185 129 / 0.5);
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8 flex items-center justify-center">

    <div id="app" class="w-full max-w-4xl bg-white p-6 md:p-10 rounded-3xl shadow-2xl border border-gray-100">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-extrabold text-gray-900 mb-2">19-Tage "Fitness"-Challenge</h1>
            <!-- Hinweis: Nicht kollaborative Version -->
            <p class="text-gray-500 font-medium">Dein lokaler Fortschritt (Wird nur in diesem Browser gespeichert!)</p>
        </header>

        <!-- Status-Anzeige (Emoji & Fortschritt) -->
        <div class="flex flex-col md:flex-row items-center justify-center space-y-6 md:space-y-0 md:space-x-8 mb-10 p-6 bg-gray-50 rounded-2xl border-2 border-dashed border-gray-200">
            
            <!-- Dynamisches Emoji -->
            <div id="status-emoji" class="text-6xl md:text-8xl transition-transform duration-500 hover:scale-110">
                😩
            </div>

            <!-- Fortschrittsbalken -->
            <div class="w-full md:w-3/5">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-xl font-bold text-gray-700">Dein Fortschritt</span>
                    <span id="progress-text" class="text-lg font-semibold text-emerald-600">0/19 Tage (0%)</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-4">
                    <div id="progress-bar" class="bg-emerald-500 h-4 rounded-full transition-all duration-700 ease-out" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- Tage-Gitter -->
        <div id="days-grid" class="grid grid-cols-4 sm:grid-cols-5 md:grid-cols-7 gap-4">
            <!-- Tage werden hier von JavaScript gerendert -->
        </div>

        <!-- Nachrichten-Bereich (für Fehler oder Status) -->
        <div id="message-box" class="mt-8 text-center hidden">
            <p id="message-content" class="text-sm p-3 rounded-xl bg-red-100 text-red-700"></p>
        </div>
    </div>

    <!-- Lokales Speicher-Skript -->
    <script type="module">
        // Schlüssel, unter dem der Fortschritt im Browser gespeichert wird
        const STORAGE_KEY = 'fitnessTrackerProgress19Days';
        const TOTAL_DAYS = 19; 

        // Initialisiert den Tracker-Zustand aus dem lokalen Speicher
        function loadTrackerState() {
            const storedState = localStorage.getItem(STORAGE_KEY);
            if (storedState) {
                // Wenn Daten vorhanden sind, parse sie
                return JSON.parse(storedState);
            }
            
            // Wenn keine Daten vorhanden sind, initialisiere sie
            const initialDays = {};
            for (let i = 1; i <= TOTAL_DAYS; i++) {
                initialDays[i.toString()] = false;
            }
            // Speichere den initialen Zustand sofort ab
            saveTrackerState(initialDays); 
            return initialDays;
        }

        // Speichert den aktuellen Zustand im lokalen Speicher
        function saveTrackerState(daysState) {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(daysState));
            } catch (error) {
                console.error("Fehler beim Speichern im LocalStorage:", error);
                showMessage("Fehler beim Speichern des Fortschritts. Der Speicher ist möglicherweise voll.", 'error');
            }
        }

        // Aktualisiert den Status eines Tages und rendert neu
        function toggleDayStatus(dayNumber, currentDays) {
            const dayKey = dayNumber.toString();
            
            // Erstelle eine Kopie des Zustands
            const updatedDays = { ...currentDays };
            // Status umschalten
            updatedDays[dayKey] = !updatedDays[dayKey];

            // Speichern und neu rendern
            saveTrackerState(updatedDays);
            renderApp(updatedDays);
        }

        // Definiert das Emoji basierend auf dem Fortschritt
        function getProgressEmoji(completedCount) {
            if (completedCount === 0) return '😩'; // Traurig
            if (completedCount <= 3) return '🙁'; // Enttäuscht
            if (completedCount <= 7) return '😐'; // Neutral
            if (completedCount <= 11) return '🙂'; // Lächelnd
            if (completedCount <= 15) return '😁'; // Breit grinsend
            if (completedCount <= 18) return '🤩'; // Sternchen-Augen
            if (completedCount === 19) return '🥳'; // Party (Ziel erreicht!)
            return '❓';
        }

        // Rendert die gesamte Anwendung basierend auf den lokalen Daten
        function renderApp(days) {
            const daysGrid = document.getElementById('days-grid');
            daysGrid.innerHTML = '';
            
            const completedDays = Object.values(days).filter(status => status).length;
            const progressPercentage = Math.round((completedDays / TOTAL_DAYS) * 100);

            // 1. Emoji und Fortschritt aktualisieren
            document.getElementById('status-emoji').textContent = getProgressEmoji(completedDays);
            document.getElementById('progress-bar').style.width = `${progressPercentage}%`;
            document.getElementById('progress-text').textContent = `${completedDays}/${TOTAL_DAYS} Tage (${progressPercentage}%)`;

            // 2. Tage rendern (1 bis 20)
            const totalCards = TOTAL_DAYS + 1; // 20 Karten
            for (let i = 1; i <= totalCards; i++) {
                const dayCard = document.createElement('div');
                const dayNumber = i.toString();

                if (i <= TOTAL_DAYS) { // Tag 1 bis 19: Interaktiver Tracker
                    const isChecked = days[dayNumber] || false;

                    dayCard.className = `day-card relative p-4 rounded-xl text-center font-bold text-xl transition-all duration-300 transform ${isChecked ? 'checked' : 'bg-white text-gray-800 hover:bg-emerald-50 active:bg-emerald-100'}`;
                    dayCard.dataset.day = dayNumber;
                    
                    dayCard.innerHTML = `
                        <span class="text-xs font-semibold ${isChecked ? 'text-white/80' : 'text-gray-400'}">TAG</span>
                        <div class="text-3xl mt-1">${dayNumber}</div>
                        ${isChecked 
                            ? '<svg class="w-6 h-6 absolute top-2 right-2 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>'
                            : '<div class="w-6 h-6 absolute top-2 right-2 text-gray-300 border-2 border-gray-300 rounded-full"></div>'
                        }
                    `;

                    // Klick-Ereignis-Listener hinzufügen
                    dayCard.addEventListener('click', () => {
                        // Da wir den aktuellen Zustand aus dem Closure der Funktion renderApp benötigen
                        // laden wir ihn hier zur Sicherheit neu.
                        const currentDays = loadTrackerState();
                        toggleDayStatus(dayNumber, currentDays);
                    });

                } else { // Tag 20: "Teletech" Party-Karte (Statisch)
                    dayCard.className = `relative p-4 rounded-xl text-center font-bold text-xl bg-purple-600 text-white shadow-lg border-4 border-purple-400 transform hover:scale-105 transition-transform duration-300`;
                    dayCard.dataset.day = dayNumber;
                    
                    dayCard.innerHTML = `
                        <span class="text-xs font-semibold text-white/80">ZIEL</span>
                        <div class="text-3xl mt-1">20</div>
                        <div class="text-base font-medium mt-1">Teletech</div>
                        <div class="text-3xl mt-2">🎉</div>
                    `;
                }

                daysGrid.appendChild(dayCard);
            }
        }

        // Zeigt eine temporäre Nachricht an
        function showMessage(text, type = 'info') {
            const box = document.getElementById('message-box');
            const content = document.getElementById('message-content');
            box.classList.remove('hidden', 'bg-red-100', 'bg-green-100', 'text-red-700', 'text-green-700');

            if (type === 'error') {
                box.classList.add('bg-red-100', 'text-red-700');
            } else if (type === 'success') {
                box.classList.add('bg-green-100', 'text-green-700');
            }
            
            content.textContent = text;
            box.classList.remove('hidden');

            setTimeout(() => {
                box.classList.add('hidden');
            }, 5000);
        }
        
        // Startpunkt: Lade den Zustand und rendere die App
        function initApp() {
            const initialDays = loadTrackerState();
            renderApp(initialDays);
        }

        window.onload = initApp;
    </script>
</body>
</html>
